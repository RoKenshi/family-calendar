<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Семейный календарь</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* Telegram 2025 flat dark theme by default */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #7661C2; /* Telegram dark theme background */
      color: #FFFFFF;
    }

    #calendar {
      background-color: #5e4fa2; /* плоский календарь */
      border: 1px solid #24A1DE;
      width: 100%;
      max-width: 900px;
      margin: auto;
    }

    .fc-event {
      border-radius: 0 !important; /* плоские события */
      padding: 2px 4px !important;
      font-weight: 500;
      color: white !important;
      border: 1px solid #24A1DE !important;
      background-color: #24A1DE !important;
    }

    /* Кнопки */
    .btn {
      border: none;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
    }

    .btn-primary { background-color: #24A1DE; color: white; }
    .btn-primary:hover { background-color: #0088CC; }

    .btn-secondary { background-color: #A19679; color: white; }
    .btn-secondary:hover { background-color: #7661C2; }

    /* Заголовок */
    header h1 {
      color: #0088CC;
    }
  </style>
</head>
<body class="flex flex-col items-center p-2">

  <header class="w-full max-w-3xl flex justify-between items-center mb-2 p-2">
    <h1 class="text-2xl font-bold">Семейный календарь</h1>
  </header>

  <!-- Календарь -->
  <div id="calendar" class="mb-2"></div>

  <!-- Панель кнопок -->
  <div class="w-full max-w-3xl flex justify-between mb-4">
    <button id="add-event" class="btn btn-primary flex-1 mr-1 py-2 px-4">Добавить событие</button>
    <button id="toggle-view" class="btn btn-secondary flex-1 ml-1 py-2 px-4">Сменить вид</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const calendarEl = document.getElementById('calendar');
    let currentView = 'dayGridMonth'; // по умолчанию месяц

    // Инициализация FullCalendar
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: currentView,
      locale: 'ru',
      selectable: true,
      editable: true, // drag & drop событий
      eventResizableFromStart: true,
      events: [],
      height: "auto",
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      eventClick: function(info) {
        const newTitle = prompt('Редактировать событие:', info.event.title);
        if (newTitle) info.event.setProp('title', newTitle);
      },
      select: function(selectionInfo) {
        const title = prompt('Название события:');
        if (title) {
          calendar.addEvent({
            title,
            start: selectionInfo.start,
            end: selectionInfo.end,
            allDay: selectionInfo.allDay,
            backgroundColor: '#24A1DE',
            borderColor: '#24A1DE',
            textColor: 'white'
          });
        }
        calendar.unselect();
      }
    });
    calendar.render();

    // Добавление события через кнопку
    document.getElementById('add-event').onclick = () => {
      const title = prompt('Название события:');
      if (!title) return;

      const dateStr = prompt('Дата события (YYYY-MM-DD):');
      if (!dateStr) return;

      calendar.addEvent({
        title,
        start: dateStr,
        backgroundColor: '#24A1DE',
        borderColor: '#24A1DE',
        textColor: 'white'
      });
    };

    // Переключение вида календаря
    document.getElementById('toggle-view').onclick = () => {
      currentView = (currentView === 'dayGridMonth') ? 'timeGridWeek' : (currentView === 'timeGridWeek') ? 'timeGridDay' : 'dayGridMonth';
      calendar.changeView(currentView);
    };
  </script>

</body>
</html>
